/* jQuery Publication Calendar v1.0.0 | MIT License */
!function(a){"use strict";a.fn.publicationCalendar=function(e){var t=a.extend({currentMonth:(new Date).getMonth(),currentYear:(new Date).getFullYear(),publications:{},onDateClick:null,detailPageUrl:"/publications/",locale:"ru",monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthNamesPrepositional:["январе","феврале","марте","апреле","мае","июне","июле","августе","сентябре","октябре","ноябре","декабре"],dayNames:["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],animationDuration:300,showMonthArrows:!0,showYearArrows:!0,showStats:!0,monthSelectPlaceholder:null,yearSelectPlaceholder:null,selectArrowIcon:'<svg width="14" height="8" viewBox="0 0 14 8"><path d="M1 1l6 6 6-6" stroke="currentColor" stroke-width="2" fill="none"/></svg>',arrowUpIcon:'<svg width="14" height="8" viewBox="0 0 14 8"><path d="M1 7l6-6 6 6" stroke="currentColor" stroke-width="2" fill="none"/></svg>',arrowDownIcon:'<svg width="14" height="8" viewBox="0 0 14 8"><path d="M1 1l6 6 6-6" stroke="currentColor" stroke-width="2" fill="none"/></svg>'},e);return this.each(function(){var e=a(this),n=t.currentMonth,o=t.currentYear,r=!1;function l(a,e){return e[a%100>4&&a%100<20?2:[2,0,1,1,1,2][Math.min(a%10,5)]]}function s(a,e){return new Date(e,a+1,0).getDate()}function c(){var a=[];for(var e in t.publications)if(t.publications.hasOwnProperty(e)){var n=parseInt(e.split("-")[0]);-1===a.indexOf(n)&&a.push(n)}return 0===a.length&&a.push(o),a.sort(function(a,e){return a-e}),a}function d(a){var e=t.publications[a];return"number"==typeof e?{count:e,url:null,text:null}:"object"==typeof e&&null!==e?{count:e.count||0,url:e.url||null,text:e.text||null}:{count:0,url:null,text:null}}function i(){var a="";a+='<div class="calendar-day-names">',t.dayNames.forEach(function(e){a+='<div class="calendar-day-name">'+e+"</div>"}),a+="</div>",a+='<div class="calendar-days">';for(var e=s(n,o),r=function(a,e){var t=new Date(e,a,1).getDay();return 0===t?6:t-1}(n,o),c=s(n-1,o),i=r-1;i>=0;i--){a+='<div class="calendar-day calendar-day-other">'+(u=c-i)+"</div>"}for(var u=1;u<=e;u++){var v=o+"-"+p(n+1)+"-"+p(u),m=d(v),h=m.count>0,f=null!==m.text&&""!==m.text,w=h||f,y="calendar-day";h&&(y+=" calendar-day-has-publications"),f&&(y+=" calendar-day-has-text"),a+='<div class="'+y+'" data-date="'+v+'" data-count="'+m.count+'" data-url="'+(m.url||"")+'" data-text="'+(m.text||"")+'">',m.url?(a+='<a href="'+m.url+'" class="calendar-day-link">',a+='<span class="calendar-day-number">'+u+"</span>",a+="</a>"):a+='<span class="calendar-day-number">'+u+"</span>",w&&(a+='<div class="calendar-day-tooltip'+(f&&!h?" calendar-day-tooltip-text":"")+'">',a+='<button class="calendar-day-tooltip-close" type="button">&times;</button>',f&&(a+='<span class="calendar-day-text">'+m.text+"</span>"),h&&(a+='<span class="calendar-day-count">'+m.count+" "+l(m.count,["публикация","публикации","публикаций"])+"</span>"),a+="</div>"),a+="</div>"}var g=7*Math.ceil((r+e)/7)-(r+e);for(u=1;u<=g;u++)a+='<div class="calendar-day calendar-day-other">'+u+"</div>";return a+="</div>"}function u(a,e){for(var t=0,n=s(a,e),o=1;o<=n;o++){t+=d(e+"-"+p(a+1)+"-"+p(o)).count}return t}function v(a){if(!r){r=!0;e.find(".calendar-grid-wrapper");var s=e.find(".calendar-grid"),c=e.find(".calendar-stats");s.addClass("calendar-animating-"+a),setTimeout(function(){if(s.html(i()),t.showStats&&c.length){var e=u(n,o);c.html("Всего опубликовано в "+t.monthNamesPrepositional[n]+" "+o+": <strong>"+e+" "+l(e,["публикация","публикации","публикаций"])+"</strong>")}s.removeClass("calendar-animating-"+a),s.addClass("calendar-animating-"+("up"===a?"down":"up")+"-in"),setTimeout(function(){s.removeClass("calendar-animating-up-in calendar-animating-down-in"),r=!1},t.animationDuration)},t.animationDuration)}}function p(a){return a<10?"0"+a:a}function m(){var a=e.find(".calendar-modal-overlay");a.length&&(a.removeClass("calendar-modal-show"),setTimeout(function(){a.remove()},300))}function h(a){var t=a.find(".calendar-day-tooltip");t.length&&(t.removeClass("tooltip-left tooltip-right tooltip-bottom"),setTimeout(function(){var n=t[0].getBoundingClientRect(),o=e[0].getBoundingClientRect();a[0].getBoundingClientRect();n.left<o.left?t.addClass("tooltip-right"):n.right>o.right&&t.addClass("tooltip-left"),n.top<o.top&&t.addClass("tooltip-bottom")},10))}function f(a,n){var o=e.find('.calendar-custom-select[data-type="'+a+'"]'),r="";"month"===a?r=t.monthNames[n]:"year"===a&&(r=n+" год"),o.find(".calendar-custom-select-trigger span").first().text(r),o.find(".calendar-custom-select-option").removeClass("selected"),o.find('.calendar-custom-select-option[data-value="'+n+'"]').addClass("selected")}e.addClass("publication-calendar"),function(){var a='<div class="calendar-container">';a+='<div class="calendar-header">',a+='<div class="calendar-controls">';var r=t.monthSelectPlaceholder||t.monthNames[n];a+='<div class="calendar-selector">',a+='<div class="calendar-custom-select calendar-month-select" data-type="month">',a+='<div class="calendar-custom-select-trigger">',a+="<span>"+r+"</span>",a+='<span class="calendar-custom-select-arrow">'+t.selectArrowIcon+"</span>",a+="</div>",a+='<div class="calendar-custom-select-options">',t.monthNames.forEach(function(e,t){a+='<div class="calendar-custom-select-option'+(t===n?" selected":"")+'" data-value="'+t+'">'+e+"</div>"}),a+="</div>",a+="</div>",a+="</div>",t.showMonthArrows&&(a+='<div class="calendar-arrows calendar-arrows-month">',a+='<button class="calendar-arrow calendar-arrow-up" type="button">',a+=t.arrowUpIcon,a+="</button>",a+='<button class="calendar-arrow calendar-arrow-down" type="button">',a+=t.arrowDownIcon,a+="</button>",a+="</div>");var s=t.yearSelectPlaceholder||o+" год";if(a+='<div class="calendar-selector">',a+='<div class="calendar-custom-select calendar-year-select" data-type="year">',a+='<div class="calendar-custom-select-trigger">',a+="<span>"+s+"</span>",a+='<span class="calendar-custom-select-arrow">'+t.selectArrowIcon+"</span>",a+="</div>",a+='<div class="calendar-custom-select-options">',c().forEach(function(e){a+='<div class="calendar-custom-select-option'+(e===o?" selected":"")+'" data-value="'+e+'">'+e+" год</div>"}),a+="</div>",a+="</div>",a+="</div>",t.showYearArrows&&(a+='<div class="calendar-arrows calendar-arrows-year">',a+='<button class="calendar-arrow calendar-arrow-up" type="button">',a+=t.arrowUpIcon,a+="</button>",a+='<button class="calendar-arrow calendar-arrow-down" type="button">',a+=t.arrowDownIcon,a+="</button>",a+="</div>"),a+="</div>",a+="</div>",a+='<div class="calendar-grid-wrapper">',a+='<div class="calendar-grid">',a+=i(),a+="</div>",a+="</div>",t.showStats){var d=u(n,o);a+='<div class="calendar-stats">',a+="Всего опубликовано в "+t.monthNamesPrepositional[n]+" "+o+": ",a+="<strong>"+d+" "+l(d,["публикация","публикации","публикаций"])+"</strong>",a+="</div>"}a+="</div>",e.html(a)}(),function(){function s(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768}e.on("click",".calendar-custom-select-trigger",function(e){e.stopPropagation();var t=a(this).closest(".calendar-custom-select"),n=t.hasClass("open");a(".calendar-custom-select").removeClass("open"),n||t.addClass("open")}),e.on("click",".calendar-custom-select-option",function(e){e.stopPropagation();var t=a(this),r=t.closest(".calendar-custom-select"),l=r.data("type"),s=parseInt(t.data("value"));r.find(".calendar-custom-select-option").removeClass("selected"),t.addClass("selected"),r.find(".calendar-custom-select-trigger span").first().text(t.text()),r.removeClass("open"),"month"===l?(n=s,v("down")):"year"===l&&(o=s,v("down"))}),a(document).on("click.calendar-select",function(e){a(e.target).closest(".calendar-custom-select").length||a(".calendar-custom-select").removeClass("open")}),e.on("click",".calendar-arrows-month .calendar-arrow-up",function(e){if(e.preventDefault(),!r){a(this).addClass("calendar-arrow-pressed"),setTimeout(()=>a(this).removeClass("calendar-arrow-pressed"),150);var t=n-1,l=o;if(t<0&&(t=11,l--,-1===c().indexOf(l)))return;o=l,f("month",n=t),f("year",o),v("up")}}),e.on("click",".calendar-arrows-month .calendar-arrow-down",function(e){if(e.preventDefault(),!r){a(this).addClass("calendar-arrow-pressed"),setTimeout(()=>a(this).removeClass("calendar-arrow-pressed"),150);var t=n+1,l=o;if(t>11&&(t=0,l++,-1===c().indexOf(l)))return;o=l,f("month",n=t),f("year",o),v("down")}}),e.on("click",".calendar-arrows-year .calendar-arrow-up",function(e){if(e.preventDefault(),!r){a(this).addClass("calendar-arrow-pressed"),setTimeout(()=>a(this).removeClass("calendar-arrow-pressed"),150);var t=c(),n=t.indexOf(o);n>0&&(f("year",o=t[n-1]),v("up"))}}),e.on("click",".calendar-arrows-year .calendar-arrow-down",function(e){if(e.preventDefault(),!r){a(this).addClass("calendar-arrow-pressed"),setTimeout(()=>a(this).removeClass("calendar-arrow-pressed"),150);var t=c(),n=t.indexOf(o);n<t.length-1&&(f("year",o=t[n+1]),v("down"))}}),e.on("click",".calendar-day-has-publications, .calendar-day-has-text",function(n){var o=a(this),r=o.data("date"),c=o.data("count"),d=o.data("url"),i=o.data("text");d&&a(n.target).closest(".calendar-day-link").length>0||(t.onDateClick?t.onDateClick(r,c,d,i):s()?(n.stopPropagation(),function(e){var t=e.hasClass("calendar-day-tooltip-active");a(".calendar-day-has-publications, .calendar-day-has-text").removeClass("calendar-day-tooltip-active"),t||(e.addClass("calendar-day-tooltip-active"),h(e))}(o)):t.showModal&&c>0&&function(a,n,o){m();var r,s,c,d=(r=a.split("-"),s=r[0],c=parseInt(r[1])-1,parseInt(r[2])+" "+t.monthNames[c].toLowerCase()+" "+s+" г."),i=(l(n,["публикация","публикации","публикаций"]),'<div class="calendar-modal-overlay">');i+='<div class="calendar-modal">',i+='<div class="calendar-modal-content">',i+='<button class="calendar-modal-close" type="button">&times;</button>',i+='<h3 class="calendar-modal-title">Публикации за день</h3>',i+='<div class="calendar-modal-date">'+d+"</div>",i+='<div class="calendar-modal-count">',i+='<span class="calendar-modal-count-number">'+n+"</span>",i+='<span class="calendar-modal-count-text">'+l(n,["публикация","публикации","публикаций"])+"</span>",i+="</div>",o&&(i+='<div class="calendar-modal-actions">',i+='<a href="'+o+'" class="calendar-modal-button" target="_blank">Перейти к статье</a>',i+="</div>"),i+="</div>",i+="</div>",i+="</div>",e.append(i),setTimeout(function(){e.find(".calendar-modal-overlay").addClass("calendar-modal-show")},10)}(r,c,d))}),a(document).on("click",function(e){a(e.target).closest(".calendar-day-has-publications, .calendar-day-has-text").length||a(".calendar-day-has-publications, .calendar-day-has-text").removeClass("calendar-day-tooltip-active")}),e.on("click",".calendar-day-tooltip-close",function(e){e.stopPropagation(),a(this).closest(".calendar-day-has-publications, .calendar-day-has-text").removeClass("calendar-day-tooltip-active")}),e.on("mouseenter",".calendar-day-has-publications, .calendar-day-has-text",function(){s()||h(a(this))}),e.on("click",".calendar-modal-close, .calendar-modal-overlay",function(){m()}),e.on("click",".calendar-modal-content",function(a){a.stopPropagation()}),a(document).on("keydown.calendar",function(a){27===a.keyCode&&m()})}(),e.data("publicationCalendar",{setPublications:function(a){t.publications=a,v("down")},goToMonth:function(a,t){n=a,o=t,e.find(".calendar-month-select").val(n),e.find(".calendar-year-select").val(o),v("down")},refresh:function(){v("down")}})})}}(jQuery);